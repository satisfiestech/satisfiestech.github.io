<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Our Products | My Store</title>
    <style>
        body { font-family: Arial, sans-serif; }
        header, footer { background: #007bff; color: white; padding: 1em; text-align: center; }
        nav a { color: white; margin: 0 10px; text-decoration: none; }
        .product-list { display: flex; flex-wrap: wrap; gap: 1em; padding: 1em; }
        .product-card { border: 1px solid #ccc; padding: 1em; width: 220px; box-sizing: border-box; }
        .product-card img {
          width: 200px;
          height: 150px;
          object-fit: cover;
          border-radius: 4px;
          display: block;
          margin-bottom: 0.5em;
        }
        .product-name { font-weight: bold; margin: 0.5em 0; }
        .product-price { color: green; margin: 0.5em 0; }
        label, input, textarea, button { width: 100%; box-sizing: border-box; }
        input, textarea { margin-bottom: 0.5em; }
        button { cursor: pointer; background-color: #007bff; color: white; border: none; padding: 0.5em; }
        button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

<header>
    <h1>Our Products</h1>
    <nav>
        <a href="index.html">Home</a> |
        <a href="cart.html">Cart</a>
    </nav>
</header>

<input type="text" id="search" placeholder="Search products..." />

<div class="product-list" id="productList">

    <!-- Add New Product form as the first card -->
    <div class="product-card">
        <h2>Add New Product</h2>
        <form id="product-form">
            <label for="name">Name:</label>
            <input type="text" id="name" required>

            <label for="description">Description:</label>
            <textarea id="description" required></textarea>

            <label for="price">Price:</label>
            <input type="number" id="price" step="0.01" required>

            <label for="stock">Stock:</label>
            <input type="number" id="stock" required>

            <label for="imageUrl">Image URL:</label>
            <input type="text" id="imageUrl">

            <button type="submit">Add Product</button>
        </form>
    </div>

    <!-- Products will be dynamically inserted here -->

</div>

<footer>
    <p>&copy; 2025 My Store. All rights reserved.</p>
</footer>

<script>
    async function fetchProducts() {
      try {
        const response = await fetch('/api/products');
        if (!response.ok) throw new Error('Network response was not ok');
        const products = await response.json();

        const productList = document.getElementById('productList');

        // Remove previously rendered product cards (except the first form card)
        // So remove all children except the first one
        while (productList.children.length > 1) {
          productList.removeChild(productList.lastChild);
        }

        products.forEach(product => {
          const productCard = document.createElement('div');
          productCard.className = 'product-card';

          productCard.innerHTML = `
            <img src="${product.imageUrl}" alt="${product.name}" />
            <div class="product-name">${product.name}</div>
            <div class="product-price">$${product.price.toFixed(2)}</div>
            <div class="product-description">${product.description}</div>
            <button onclick="addToCart(${product.id})">Add to Cart</button>
          `;

          productList.appendChild(productCard);
        });
      } catch (error) {
        console.error('Failed to fetch products:', error);
      }
    }

    function addToCart(productId) {
      alert('Add to Cart clicked for product ID ' + productId);
      // Implement your add to cart logic here
    }

    // Handle new product form submission
    document.getElementById('product-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const newProduct = {
        name: document.getElementById('name').value.trim(),
        description: document.getElementById('description').value.trim(),
        price: parseFloat(document.getElementById('price').value),
        stock: parseInt(document.getElementById('stock').value),
        imageUrl: document.getElementById('imageUrl').value.trim()
      };

      try {
        const response = await fetch('/api/products', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newProduct)
        });

        if (!response.ok) {
          throw new Error('Failed to add product');
        }

        alert('Product added successfully!');
        this.reset();  // clear form
        fetchProducts(); // refresh product list
      } catch (error) {
        alert('Error: ' + error.message);
      }
    });

    document.getElementById('search').addEventListener('input', function() {
      const query = this.value.toLowerCase();
      const cards = document.querySelectorAll('.product-card:not(:first-child)'); // exclude first form card
      cards.forEach(card => {
        const name = card.querySelector('.product-name').textContent.toLowerCase();
        card.style.display = name.includes(query) ? '' : 'none';
      });
    });

    // Load products when page loads
    window.onload = fetchProducts;
</script>

</body>
</html>
